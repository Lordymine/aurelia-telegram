# Story 3.1: Claude Code CLI Bridge

## Status

**Ready for Review**

## Story

**As a** developer,
**I want** the bot to execute commands in Claude Code,
**so that** ADE operations run when I send messages in Telegram.

## Acceptance Criteria

1. Módulo `src/bridge/claude-code.ts` que spawna processo Claude Code CLI
2. Função `execute(prompt, options)` que retorna output como string
3. Gerenciamento de processo: spawn, stdin write, stdout/stderr read, kill
4. Timeout configurável por operação
5. Detecção de estado: running, completed, failed, timeout
6. Queue de comandos (um por vez por sessão, rejeita pendentes se ocupado)
7. Testes unitários com mock de child_process

## Tasks / Subtasks

- [x] Task 1: Implement ClaudeCodeBridge class (AC: 1-3)
- [x] Task 2: Add timeout and state management (AC: 4-5)
- [x] Task 3: Add one-at-a-time command guard (AC: 6)
- [x] Task 4: Write unit tests (AC: 7)
- [x] Task 5: Fix ESLint config for test files
- [x] Task 6: Validation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Story draft + implementation | River (SM) + Dex (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6 (claude-opus-4-6)

### File List

| File | Status | Description |
|------|--------|-------------|
| `src/bridge/claude-code.ts` | Modified | Full Claude Code CLI bridge (was stub) |
| `tests/unit/bridge/claude-code.test.ts` | Created | 17 tests for bridge |
| `eslint.config.js` | Modified | Fixed projectService for test files |
| `tests/unit/config/encryption.test.ts` | Modified | Removed unused imports |
| `tests/unit/kimi/translator.test.ts` | Modified | Removed unused imports |
