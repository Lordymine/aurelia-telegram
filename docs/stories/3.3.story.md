# Story 3.3: Full Pipeline Integration

## Status

**Ready for Review**

## Story

**As a** developer,
**I want** to access all ADE pipeline stages from Telegram,
**so that** I can manage my entire development workflow remotely.

## Acceptance Criteria

1. Core Engine module `src/core/engine.ts` that orchestrates Kimi translation → ADE execution → response translation
2. Message handler wired to use Core Engine (replaces echo handler)
3. Confidence threshold: >= 0.7 auto-execute, < 0.7 ask clarification
4. Progress messages sent to Telegram ("Processing...") with edits for updates
5. Final response translated by Kimi and sent back to user
6. Agent switching context maintained per user
7. Integration tests for the full pipeline

## Tasks / Subtasks

- [x] Task 1: Implement Core Engine (AC: 1, 3)
- [x] Task 2: Wire message handler to Core Engine (AC: 2, 4-5)
- [x] Task 3: Agent context tracking (AC: 6)
- [x] Task 4: Write tests (AC: 7)
- [x] Task 5: Validation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Story draft + implementation | River (SM) + Dex (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6 (claude-opus-4-6)

### File List

| File | Status | Description |
|------|--------|-------------|
| `src/core/engine.ts` | Modified | Full AureliaEngine: Kimi→Bridge→Kimi pipeline (was stub) |
| `src/bot/handlers/messages.ts` | Modified | Added createMessageHandler with engine integration |
| `src/bot/index.ts` | Modified | Wired engine to bot, options pattern |
| `src/index.ts` | Modified | Added AureliaEngine exports |
| `tests/unit/core/engine.test.ts` | Created | 9 tests for engine pipeline |
