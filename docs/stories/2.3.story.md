# Story 2.3: Kimi Translation Engine

## Status

**Ready for Review**

## Story

**As a** developer,
**I want** my Telegram messages translated into ADE commands and vice-versa,
**so that** I can control development naturally.

## Acceptance Criteria

1. Módulo `src/kimi/translator.ts` com funções `translateUserToADE()` e `translateADEToUser()`
2. `translateUserToADE()`: envia mensagem + protocol + contexto ao Kimi, recebe comando ADE (JSON)
3. `translateADEToUser()`: envia output do ADE ao Kimi, recebe resumo legível para Telegram
4. Formato de saída estruturado: `{ action, agent, command, args, confidence }`
5. Se confidence < threshold, Kimi gera pergunta de clarificação
6. Conversation history mantido para contexto (últimas N mensagens)
7. Message splitting: respostas longas quebradas em chunks ≤ 4096 chars
8. Testes unitários com mocks de chamadas Kimi

## Tasks / Subtasks

- [x] Task 1: Implement Kimi API client (AC: 1)
- [x] Task 2: Implement translator functions (AC: 1-6)
- [x] Task 3: Implement message splitting (AC: 7)
- [x] Task 4: Write unit tests (AC: 8)
- [x] Task 5: Validation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 0.1 | Story draft + implementation | River (SM) + Dex (Dev) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6 (claude-opus-4-6)

### File List

| File | Status | Description |
|------|--------|-------------|
| `src/kimi/client.ts` | Modified | Moonshot API client with chatCompletion function (was stub) |
| `src/kimi/translator.ts` | Modified | Bidirectional translation + message splitting (was stub) |
| `tests/unit/kimi/client.test.ts` | Created | 4 tests for Kimi API client |
| `tests/unit/kimi/translator.test.ts` | Created | 10 tests for translator + message splitting |
